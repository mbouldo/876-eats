<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Jockey+One&family=Poppins:ital,wght@0,400;0,600;0,700;0,800;0,900;1,400&display=swap"
        rel="stylesheet">
    <link href="./output.css" rel="stylesheet">
</head>

<body class="bg-bGray text-white font-poppins">
    <div class="flex justify-center w-full">
        <div class="view w-[640px] border border-gray-700 ">

            <nav class="py-4 border-b border-b-white">
                <h1 class="font-jockey text-center text-4xl">867 Eats</h1>
            </nav>
            <main class="mx-6">
                <div class="w-full flex justify-center mt-5">
                    <button type="button"
                        class="bg-bGold text-bGray btn">
                        Back to All Orders
                    </button>
                </div>

                <section class="bg-white min-h-[500px] mt-6 rounded text-bGray px-4 py-4" >
             
                  <!-- Orders get appended here -->
    

                    <div>
                        <label class="text-xs input-label">Name</label>
                        <input type='text' class="input" id="name" />
                    </div>
                    <div class="mt-3">
                        <label class="text-xs input-label">Deliver to</label>
                        <input type='text' class="input" id="deliver_to"/>
                    </div>
                    <div id="menu">
                      <h3 class="font-bold text-xs mt-4">Menu</h3>
                    </div>
                    <div class="mt-6">
                        <label class="text-xs input-label">Extra Note</label>
                        <input type='text' class="input" id="note"/>
                    </div>
                    <div class="fjb mt-4"> 
                        <h3>Order total:</h3>
                        <h3 id="totalPrice">$18.45</h3>
                    </div>
                    
                    <div id="" class="mt-4">
                        <button type="button" class="bg-bGreen text-white btn mt-3" onclick="postOrder()">
                            Post Order
                        </button>
                    </div>

                </section>
            </main>

        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="main.js"></script>
<script>

    let orders = [
        {
            id: 48,
            customer_name: "John",
            order_time: "2024-01-24 8:00:00",
            order_status: "pending",
            order_total: 18.45,
            order_daily_index: 3,
            order_items: [
                {
                    count: 1,
                    item_name: "$14.99 Plate (Jerk Chicken, R&P)",
                },
                {
                    count: 1,
                    item_name: "+ Festivals",
                },
                {
                    count: 3,
                    item_name: "+ Vegetable",
                }
            ]
        }
    ]


    let menu = [
        {
            id: 1,
            name: 'Jerk Chicken Plate',
            price: 14.99,
            ingredients:['Jerk Chicken', 'Rice & Peas'],
        },
        {
            id: 2,
            name: 'Brown Stew Chicken Plate',
            price: 14.99,
            ingredients:['Brown Stew Chicken', 'Rice & Peas'],
        },
       
    ]

    function markupMenuItem(menuItemObj){
        let markup = `
            <div class="bg-bGray text-white  rounded mt-4 fjb select-none cursor-pointer menu_item" id="menu_item_${menuItemObj.id}">
                <div class="py-2 pl-2   grow mr-2" onclick="addItemToOrder('${menuItemObj.id}')">
                    <div>
                        <span class="price">$${menuItemObj.price}</span> <span class="span item_name">${menuItemObj.name}</span>
                    </div>
                    <div class="text-xs">
                        ${menuItemObj.ingredients.join(', ')}
                    </div>
                </div>
                <div class="f text-xl bold items-center">
                    <div class="mr-5" id="menu_item_count_${menuItemObj.id}">0</div>
                    <button type="button" class=" px-4 py-1" onclick="removeItemFromOrder('${menuItemObj.id}')">-</button>
                </div>
            </div>
        `
        $('#menu').append(markup);
    }

    function markupMenu(menu){
        menu.forEach(menuItem => {
            markupMenuItem(menuItem);
        })
    }

    markupMenu(menu);

    function addItemToOrder(id){
        // 1) get menu item by id
        // 2) add menu item to order
        // 3) update order total
        let menuItem = menu.find(menuItem => menuItem.id == id);

        let menuItemPostOrders = postOrders.find(postOrder => postOrder.id == id);
        // if not present push {id: 1, count: 1}
        // if present increment count
        if(!menuItemPostOrders){
            postOrders.push({id: id, count: 1, unitPrice: menuItem.price});
        }else{
            menuItemPostOrders.count++;
        }
        menuItemPostOrders = postOrders.find(postOrder => postOrder.id == id);

        $(`#menu_item_count_${id}`).text(menuItemPostOrders.count);
        if(menuItemPostOrders.count > 0){
            $(`#menu_item_${id}`).addClass('bg-bGreen');
            $(`#menu_item_${id}`).removeClass('bg-bGray');
        }else{
            $(`#menu_item_${id}`).adshakedClass('bg-bGray');
            $(`#menu_item_${id}`).removeClass('bg-bGreen');
        }
        updateTotalPrice();
    }

    function removeItemFromOrder(id){
        // 1) get menu item by id
        // 2) remove menu item from order
        // 3) update order total
        let menuItem = menu.find(menuItem => menuItem.id == id);

        let menuItemPostOrders = postOrders.find(postOrder => postOrder.id == id);
        // if not present push {id: 1, count: 1}
        // if present increment count
        if(!menuItemPostOrders){
            //shake element:
            $(`#menu_item_${id}`).addClass('shake');
            //settimeout remove shake class
            setTimeout(() => {
                $(`#menu_item_${id}`).removeClass('shake');
            }, 500);
            return;
        }else{
            menuItemPostOrders.count--;
        }
        menuItemPostOrders = postOrders.find(postOrder => postOrder.id == id);

        $(`#menu_item_count_${id}`).text(menuItemPostOrders.count);
        if(menuItemPostOrders.count > 0){
            $(`#menu_item_${id}`).addClass('bg-bGreen');
            $(`#menu_item_${id}`).removeClass('bg-bGray');
        }else{
            $(`#menu_item_${id}`).addClass('bg-bGray');
            $(`#menu_item_${id}`).removeClass('bg-bGreen');
        }

        if(menuItemPostOrders.count == 0){
            postOrders = postOrders.filter(postOrder => postOrder.id != id);
        }
        updateTotalPrice();
    }

    function updateTotalPrice(){
        let totalPrice = postOrders.reduce((acc, postOrder) => {
            return acc + (postOrder.count * postOrder.unitPrice);
        }, 0);
        $("#totalPrice").text("$" + totalPrice.toFixed(2));
    }


    let postOrders = [];


    function postOrder(){
        let postObj = {
            name: $('#name').val(),
            deliver_to: $('#deliver_to').val(),
            note: $('#note').val(),
            order_items: postOrders,
        }

        if(!postObj.name){
            alert('Please enter a name');
            return;
        }
        if(postObj.order_items.length==0){
            alert('Please add to the menu');
            return;
        }

        console.log(postObj);
        return;

        $.ajax({
            url: 'http://localhost:3000/orders',
            type: 'POST',
            data: postObj,
            success: function(result) {
                console.log(result);
                window.location.href = '/orders';
            }
        });
    }
  

  






</script>

</html>